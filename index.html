<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login + Lista de Tarefas</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-5" id="login-screen">
    <h2>Login</h2>
    <div class="mb-3">
      <label for="username" class="form-label">Usuário</label>
      <input type="text" class="form-control" id="username">
    </div>
    <div class="mb-3">
      <label for="password" class="form-label">Senha</label>
      <input type="password" class="form-control" id="password">
    </div>
    <button class="btn btn-primary" onclick="login()">Entrar</button>
    <div id="login-error" class="text-danger mt-2" style="display:none;">Usuário ou senha inválido!</div>
  </div>

  <div class="container mt-4" id="todo-app" style="display:none;">
    <h1>Minha Lista de Tarefas</h1>
    <div class="input-group mb-3">
      <input type="text" id="new-task" class="form-control" placeholder="Adicionar nova tarefa...">
      <input type="date" id="due-date" class="form-control" style="max-width: 200px;">
      <button class="btn btn-outline-success" type="button" onclick="addTask()">Adicionar</button>
    </div>
    <ul id="task-list" class="list-group"></ul>
    <button class="btn btn-secondary mt-3" onclick="logout()">Sair</button>
  </div>

  <!-- Modal de Confirmação -->
  <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmDeleteModalLabel">Confirmar Exclusão</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          Tem certeza que deseja excluir esta tarefa?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Excluir</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const USER = 'admin';
    const PASSWORD = 'admin';

    const taskInput = document.getElementById('new-task');
    const dueDateInput = document.getElementById('due-date');
    const taskList = document.getElementById('task-list');
    const localStorageKey = 'taskList';

    let taskToDelete = null; // variável global para guardar a tarefa a ser excluída

    document.addEventListener('DOMContentLoaded', () => {
      if (localStorage.getItem('loggedIn') === 'true') {
        showTodoApp();
        loadTasks();
      }
    });

    function login() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      const errorBox = document.getElementById('login-error');

      if (username === USER && password === PASSWORD) {
        localStorage.setItem('loggedIn', 'true');
        errorBox.style.display = 'none';
        showTodoApp();
        loadTasks();
      } else {
        errorBox.style.display = 'block';
      }
    }

    function logout() {
      localStorage.removeItem('loggedIn');
      document.getElementById('todo-app').style.display = 'none';
      document.getElementById('login-screen').style.display = 'block';
    }

    function showTodoApp() {
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('todo-app').style.display = 'block';
    }

    function loadTasks() {
        taskList.innerHTML = "";
      const storedTasks = localStorage.getItem(localStorageKey);
      if (storedTasks) {
        const tasks = JSON.parse(storedTasks);
        tasks.forEach(task => {
          addTaskToDOM(task.text, task.finished, task.dueDate);
        });
      }
    }

    function saveTasks() {
      const tasks = [];
      taskList.querySelectorAll('.list-group-item').forEach(item => {
        const span = item.querySelector('.task-text');
        const dueDate = item.getAttribute('data-due-date');
        tasks.push({
          text: span.textContent.split(' (Entrega:')[0],
          finished: span.classList.contains('finished'),
          dueDate: dueDate
        });
      });
      localStorage.setItem(localStorageKey, JSON.stringify(tasks));
    }

    function addTask() {
      const taskText = taskInput.value.trim();
      const dueDate = dueDateInput.value;

      if (taskText !== "" && dueDate !== "") {
        addTaskToDOM(taskText, false, dueDate);
        taskInput.value = "";
        dueDateInput.value = "";
        saveTasks();
      } else {
        alert('Por favor, preencha a tarefa e a data de entrega!');
      }
    }

    function addTaskToDOM(text, finished, dueDate) {
      const listItem = document.createElement('li');
      listItem.classList.add('list-group-item');
      listItem.setAttribute('data-due-date', dueDate);

      const statusHTML = finished
        ? '<span class="status-ok">✅ OK</span>'
        : '<span class="status-ok" style="visibility: hidden;">✅ OK</span>';

      const formattedText = `${text} (Entrega: ${formatDate(dueDate)})`;

      listItem.innerHTML = `
        ${statusHTML}
        <span class="task-text ${finished ? 'finished' : ''}">${formattedText}</span>
        <div class="task-actions">
          <button class="btn btn-sm btn-warning" onclick="finishTask(this)">Finalizar</button>
          <button class="btn btn-sm btn-danger" onclick="removeTask(this)">Excluir</button>
        </div>
      `;

      taskList.appendChild(listItem);
    }

    function removeTask(button) {
      taskToDelete = button.closest('.list-group-item');
      const confirmModal = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));
      confirmModal.show();
    }

    document.getElementById('confirmDeleteBtn').addEventListener('click', () => {
      if (taskToDelete) {
        taskToDelete.remove();
        saveTasks();
        taskToDelete = null;
      }
      const confirmModal = bootstrap.Modal.getInstance(document.getElementById('confirmDeleteModal'));
      confirmModal.hide();
    });

    function finishTask(button) {
      const listItem = button.closest('.list-group-item');
      const textSpan = listItem.querySelector('.task-text');
      const statusSpan = listItem.querySelector('.status-ok');

      textSpan.classList.toggle('finished');
      statusSpan.style.visibility = textSpan.classList.contains('finished') ? 'visible' : 'hidden';

      saveTasks();
    }

    function formatDate(dateStr) {
      const parts = dateStr.split('-');
      return `${parts[2]}/${parts[1]}/${parts[0]}`; // Formato: dd/mm/yyyy
    }
  </script>
</body>
</html>
