<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login + Lista de Tarefas</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-5" id="login-screen">
    <h2>Login</h2>
    <div class="mb-3">
      <label for="username" class="form-label">Usuário</label>
      <input type="text" class="form-control" id="username">
    </div>
    <div class="mb-3">
      <label for="password" class="form-label">Senha</label>
      <input type="password" class="form-control" id="password">
    </div>
    <button class="btn btn-primary" onclick="login()">Entrar</button>
    <div id="login-error" class="text-danger mt-2" style="display:none;">Usuário ou senha inválido!</div>
  </div>

  <div class="container mt-4" id="todo-app" style="display:none;">
    <h1>Minha Lista de Tarefas</h1>
    <div class="input-group mb-3">
      <input type="text" id="new-task" class="form-control" placeholder="Adicionar nova tarefa...">
      <button class="btn btn-outline-success" type="button" onclick="addTask()">Adicionar</button>
    </div>
    <ul id="task-list" class="list-group"></ul>
    <button class="btn btn-secondary mt-3" onclick="logout()">Sair</button>
  </div>

  <script>
    const USER = 'admin';
    const PASSWORD = 'admin';

    const taskInput = document.getElementById('new-task');
    const taskList = document.getElementById('task-list');
    const localStorageKey = 'taskList';

    document.addEventListener('DOMContentLoaded', () => {
      if (localStorage.getItem('loggedIn') === 'true') {
        showTodoApp();
        loadTasks();
      }
    });

    function login() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      const errorBox = document.getElementById('login-error');

      if (username === USER && password === PASSWORD) {
        localStorage.setItem('loggedIn', 'true');
        errorBox.style.display = 'none';
        showTodoApp();
        loadTasks();
      } else {
        errorBox.style.display = 'block';
      }
    }

    function logout() {
      localStorage.removeItem('loggedIn');
      document.getElementById('todo-app').style.display = 'none';
      document.getElementById('login-screen').style.display = 'block';
    }

    function showTodoApp() {
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('todo-app').style.display = 'block';
    }

    function loadTasks() {
      const storedTasks = localStorage.getItem(localStorageKey);
      if (storedTasks) {
        const tasks = JSON.parse(storedTasks);
        tasks.forEach(task => {
          addTaskToDOM(task.text, task.finished);
        });
      }
    }

    function saveTasks() {
      const tasks = [];
      taskList.querySelectorAll('.list-group-item').forEach(item => {
        const span = item.querySelector('.task-text');
        tasks.push({
          text: span.textContent,
          finished: span.classList.contains('finished')
        });
      });
      localStorage.setItem(localStorageKey, JSON.stringify(tasks));
    }

    function addTask() {
      const taskText = taskInput.value.trim();
      if (taskText !== "") {
        addTaskToDOM(taskText, false);
        taskInput.value = "";
        saveTasks();
      }
    }

    function addTaskToDOM(text, finished) {
      const listItem = document.createElement('li');
      listItem.classList.add('list-group-item');

      const statusHTML = finished
        ? '<span class="status-ok">✅ OK</span>'
        : '<span class="status-ok" style="visibility: hidden;">✅ OK</span>';

      listItem.innerHTML = `
        ${statusHTML}
        <span class="task-text ${finished ? 'finished' : ''}">${text}</span>
        <div class="task-actions">
          <button class="btn btn-sm btn-warning" onclick="finishTask(this)">Finalizar</button>
          <button class="btn btn-sm btn-danger" onclick="removeTask(this)">Excluir</button>
        </div>
      `;

      taskList.appendChild(listItem);
    }

    function removeTask(button) {
      const listItem = button.closest('.list-group-item');
      listItem.remove();
      saveTasks();
    }

    function finishTask(button) {
      const listItem = button.closest('.list-group-item');
      const textSpan = listItem.querySelector('.task-text');
      const statusSpan = listItem.querySelector('.status-ok');

      textSpan.classList.toggle('finished');

      statusSpan.style.visibility = textSpan.classList.contains('finished') ? 'visible' : 'hidden';

      saveTasks();
    }
  </script>
</body>
</html>
